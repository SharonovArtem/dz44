using System;
using System.Collections.Generic;

namespace ConsoleApp9
{
    internal class Program
    {
        static void Main(string[] args)
        {
            Station station = new Station();
            bool isWorking = true;

            while (isWorking)
            {
                station.ShowInfoAboutAboutTrainList();
                Console.WriteLine("Нажмите на Q чтобы создать поезд");
                Console.WriteLine("Чтобы выйти нажмите Esc");
                ConsoleKeyInfo keyInput = Console.ReadKey(true);

                if (keyInput.Key == ConsoleKey.Q)
                {
                    station.CreateTrain();
                }
                else if (keyInput.Key == ConsoleKey.Escape)
                {
                    isWorking = false;
                }
            }
        }
    }

    class Direction
    {
        public string StartPoint { get; private set; }
        public string FinishPoint { get; private set; }

        public Direction(string startPoint, string finishPoint)
        {
            StartPoint = startPoint;
            FinishPoint = finishPoint;
        }

        public void AddDirection()
        {
            bool isWorking = true;

            while (isWorking)
            {
                Console.WriteLine("Откуда поедет поезд?");
                StartPoint = Console.ReadLine();

                Console.WriteLine("Какая конечная точка?");
                FinishPoint = Console.ReadLine();

                if (FinishPoint != StartPoint)
                {
                    isWorking = false;
                }
                else
                {
                    Console.WriteLine("Не удалось создать поезд");
                }
            }
        }

        public void ShowDirection()
        {
            Console.WriteLine(StartPoint + " - " + FinishPoint);
        }
    }

    class Van
    {
        public int MaxAccomodation { get; private set; }

        public Van(int maxAccomodation)
        {
            MaxAccomodation = maxAccomodation;
        }
    }

    class Station
    {
        private List<Flight> _flights = new List<Flight>();
        
        public void CreateTrain()
        {
            int _passengersNumber;
            int _occupiedPlaces = 0;
            int minimalPassangersNumber = 50;
            int maximalPassangersNumber = 400;
            int sizeOfSmallVan = 50;
            int sizeOfMediumVan = 75;
            int sizeOfLargeVan = 100;
            int smallVanNumber = 0;
            int mediumVanNumber = 1;
            int largeVanNumber = 2;
            int maximalRandomNumber = 3;           
            int _occupiedVansNumber = 0;
            Direction _direction = new Direction(null, null);
            List<Van> _occupiedVans = new List<Van>();

            _direction.AddDirection();

            Random random = new Random();

            _passengersNumber = random.Next(minimalPassangersNumber, maximalPassangersNumber);

            while (_occupiedPlaces < _passengersNumber)
            {
                int typeOfVan = random.Next(smallVanNumber, maximalRandomNumber);

                if (typeOfVan == smallVanNumber)
                {
                    Van van = new Van(sizeOfSmallVan);
                    _occupiedVans.Add(van);
                    _occupiedVansNumber++;
                    _occupiedPlaces += van.MaxAccomodation;
                }
                else if (typeOfVan == mediumVanNumber)
                {
                    Van van = new Van(sizeOfMediumVan);
                    _occupiedVans.Add(van);
                    _occupiedVansNumber++;
                    _occupiedPlaces += van.MaxAccomodation;
                }
                else if (typeOfVan == largeVanNumber)
                {
                    Van van = new Van(sizeOfLargeVan);
                    _occupiedVans.Add(van);
                    _occupiedVansNumber++;
                    _occupiedPlaces += van.MaxAccomodation;
                }
            }

            Flight train = new Flight(_direction, _occupiedVans, _occupiedVansNumber, _passengersNumber);

            _flights.Add(train);

            Console.WriteLine("Количество вагонов в поезде: " + _occupiedVansNumber + " вагонов");
            Console.WriteLine("Общее количество занятых мест: " + _passengersNumber + " мест");
            Console.WriteLine("Направление поезда: ");
            _direction.ShowDirection();
        }

        public void ShowInfoAboutAboutTrainList()
        {
            for (int i = 0; i < _flights.Count; i++)
            {
                Console.WriteLine("Рейс номер: " + i + ":");
                _flights[i].ShowInfo();
            }
        }
    }

    class Flight
    {
        private List<Van> _occupiedVans;
        private int _vansNumber;
        private int _passengersNumber;
        private Direction _direction;

        public Flight(Direction direction, List<Van> occupiedVans, int vans, int passengersNumber)
        {
            _occupiedVans = occupiedVans;
            _vansNumber = vans;
            _passengersNumber = passengersNumber;
            _direction = direction;
        }

        public void ShowInfo()
        {
            Console.WriteLine(_vansNumber);
            Console.WriteLine(_passengersNumber);
            Console.WriteLine(_direction.StartPoint);
            Console.WriteLine(_direction.FinishPoint);
        }

        public void AddVan(Van van)
        {
            _occupiedVans.Add(van);
        }
    }
}
